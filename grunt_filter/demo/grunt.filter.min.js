export function attachTableFilterWithSuggest({searchInputId:e,tableBodyId:t,categorySelectId:l=null,nameColumnIndex:n=0,categoryColumnIndex:r=1,dateColumnIndex:i=null,fromDateInputId:o=null,toDateInputId:u=null,caseSensitive:a=!1,debounceTime:d=0,onFilter:s=null,enableSuggest:c=!0,maxSuggestions:f=5}){var g,p;let y=document.getElementById(e),h=document.getElementById(t),m=l?document.getElementById(l):null,v=o?document.getElementById(o):null,E=u?document.getElementById(u):null;if(!y||!h)return;let x=e=>a?e.trim():e.toLowerCase().trim(),$=e=>{let t=new Date(e);return isNaN(t)?null:t},C=c?document.createElement("ul"):null;C&&(Object.assign(C.style,{position:"absolute",zIndex:"9999",listStyle:"none",margin:0,padding:0,border:"1px solid #ccc",backgroundColor:"#222",color:"#fff",fontSize:"0.9rem",maxHeight:"200px",overflowY:"auto",display:"none"}),document.body.appendChild(C),y.addEventListener("blur",()=>{setTimeout(()=>C.style.display="none",120)}));let b=e=>{if(!C)return;let t=Array.from(h.querySelectorAll("tr")),l=[];for(let r of t){let i=r.cells;if(!i||0===i.length)continue;let o=x(i[n]?.textContent||"");if(o.includes(e)&&!l.includes(o)&&(l.push(o),l.length>=f))break}for(;C.firstChild;)C.removeChild(C.firstChild);l.forEach(e=>{let t=document.createElement("li");t.textContent=e,Object.assign(t.style,{padding:"5px 10px",cursor:"pointer"}),t.addEventListener("mousedown",()=>{y.value=e,L()}),C.appendChild(t)});let u=y.getBoundingClientRect();C.style.left=`${u.left+window.scrollX}px`,C.style.top=`${u.bottom+window.scrollY}px`,C.style.width=`${u.width}px`,C.style.display=l.length?"block":"none"},L=()=>{let e=x(y.value),t=m?.value||"",l=v?.value?$(v.value):null,o=E?.value?$(E.value):null,u=0;Array.from(h.querySelectorAll("tr")).forEach(a=>{let d=a.cells;if(!d||0===d.length)return;let s=x(d[n]?.textContent||""),c=d[r]?.getAttribute("data-cat-id")||"",f=null!==i?d[i]?.textContent.trim():"",g=null!==i?$(f):null,p=!e||s.includes(e),y=p&&(!t||c===t)&&(null===i||(!l||g&&g>=l)&&(!o||g&&g<=o));a.style.display=y?"":"none",y&&u++}),"function"==typeof s&&s(u)},w,B=d>0?(g=()=>{L(),c&&b(x(y.value))},p=d,(...e)=>{clearTimeout(w),w=setTimeout(()=>g(...e),p)}):()=>{L(),c&&b(x(y.value))};y.addEventListener("input",B),m&&m.addEventListener("change",B),v&&v.addEventListener("change",B),E&&E.addEventListener("change",B)}